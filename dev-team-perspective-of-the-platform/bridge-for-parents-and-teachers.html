
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <title>家校通应用 · Microsoft Teams 完全手册</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="通过Teams让家长与老师互动，并了解孩子学习情况">
        <meta name="generator" content="HonKit 3.6.23">
        <meta name="author" content="陈希章">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
<!-- -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8HPPH9FRTD"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'G-8HPPH9FRTD');
</script>
 
    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    关于本书
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">本书简介和资源</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../resource-of-the-book/preface-from-roan.html">
            
                <a href="../resource-of-the-book/preface-from-roan.html">
            
                    
                    推荐序 : 基于Microsoft Teams平台打造创新的混合办公体验
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../resource-of-the-book/preface-from-doctor-xu.html">
            
                <a href="../resource-of-the-book/preface-from-doctor-xu.html">
            
                    
                    推荐序：洞悉用户角色, 从场景出发的最佳实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../resource-of-the-book/preface-from-doctor-wang.html">
            
                <a href="../resource-of-the-book/preface-from-doctor-wang.html">
            
                    
                    推荐序：以成长心态持续推动平台建设和创新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../resource-of-the-book/preface-of-the-book.html">
            
                <a href="../resource-of-the-book/preface-of-the-book.html">
            
                    
                    作者自序：东临碣石，以观沧海
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../resource-of-the-book/convention-of-the-book.html">
            
                <a href="../resource-of-the-book/convention-of-the-book.html">
            
                    
                    本书约定
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../resource-of-the-book/recommendations.html">
            
                <a href="../resource-of-the-book/recommendations.html">
            
                    
                    推荐评语
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../teams-platform-overview/">
            
                <a href="../teams-platform-overview/">
            
                    
                    Microsoft Teams 平台概述
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../teams-platform-overview/teams-roadmap.html">
            
                <a href="../teams-platform-overview/teams-roadmap.html">
            
                    
                    Microsoft Teams 及其发展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../teams-platform-overview/teamsplatform-architecture.html">
            
                <a href="../teams-platform-overview/teamsplatform-architecture.html">
            
                    
                    Microsoft Teams 平台架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../teams-platform-overview/teamsplatform-capabilities/">
            
                <a href="../teams-platform-overview/teamsplatform-capabilities/">
            
                    
                    平台能力一览
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.1" data-path="../teams-platform-overview/teamsplatform-capabilities/teams-tab-overview.html">
            
                <a href="../teams-platform-overview/teamsplatform-capabilities/teams-tab-overview.html">
            
                    
                    选项卡（Tab）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.2" data-path="../teams-platform-overview/teamsplatform-capabilities/teams-bot-overview.html">
            
                <a href="../teams-platform-overview/teamsplatform-capabilities/teams-bot-overview.html">
            
                    
                    机器人（Bot）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.3" data-path="../teams-platform-overview/teamsplatform-capabilities/message-extension.html">
            
                <a href="../teams-platform-overview/teamsplatform-capabilities/message-extension.html">
            
                    
                    消息扩展（Message extension）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4" data-path="../teams-platform-overview/teamsplatform-capabilities/connector.html">
            
                <a href="../teams-platform-overview/teamsplatform-capabilities/connector.html">
            
                    
                    连接器（Connector）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.5" data-path="../teams-platform-overview/teamsplatform-capabilities/notification.html">
            
                <a href="../teams-platform-overview/teamsplatform-capabilities/notification.html">
            
                    
                    通知 (Notification)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.6" data-path="../teams-platform-overview/teamsplatform-capabilities/microsoft-graph.html">
            
                <a href="../teams-platform-overview/teamsplatform-capabilities/microsoft-graph.html">
            
                    
                    Microsoft Graph
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="../teams-platform-overview/power-platform-integration.html">
            
                <a href="../teams-platform-overview/power-platform-integration.html">
            
                    
                    Power Platform 整合
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../users-prespective-of-the-platform/">
            
                <a href="../users-prespective-of-the-platform/">
            
                    
                    从最终用户角度看平台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../users-prespective-of-the-platform/install-configure-teams.html">
            
                <a href="../users-prespective-of-the-platform/install-configure-teams.html">
            
                    
                    安装和配置 Teams
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="../users-prespective-of-the-platform/join-or-quit-other-orgs-as-guest.html">
            
                <a href="../users-prespective-of-the-platform/join-or-quit-other-orgs-as-guest.html">
            
                    
                    作为来宾加入其他组织
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="../users-prespective-of-the-platform/chat-based-communcation-and-collaboration.html">
            
                <a href="../users-prespective-of-the-platform/chat-based-communcation-and-collaboration.html">
            
                    
                    基于聊天的沟通协作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="../users-prespective-of-the-platform/audio-video-meeting-scenarios.html">
            
                <a href="../users-prespective-of-the-platform/audio-video-meeting-scenarios.html">
            
                    
                    音视频会议及其创新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.5" data-path="../users-prespective-of-the-platform/mobile-device-experience.html">
            
                <a href="../users-prespective-of-the-platform/mobile-device-experience.html">
            
                    
                    移动端体验
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.6" data-path="../users-prespective-of-the-platform/discover-install-teams-apps.html">
            
                <a href="../users-prespective-of-the-platform/discover-install-teams-apps.html">
            
                    
                    发现和安装应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.7" data-path="../users-prespective-of-the-platform/empower-every-person-with-power-platform.html">
            
                <a href="../users-prespective-of-the-platform/empower-every-person-with-power-platform.html">
            
                    
                    用Power Platform释放你的潜能
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../it-prespective-of-the-platform/">
            
                <a href="../it-prespective-of-the-platform/">
            
                    
                    从 IT 管理运营角度看平台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../it-prespective-of-the-platform/plan-and-adoption.html">
            
                <a href="../it-prespective-of-the-platform/plan-and-adoption.html">
            
                    
                    规划 Teams 和推广路径
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="../it-prespective-of-the-platform/admin-and-tools.html">
            
                <a href="../it-prespective-of-the-platform/admin-and-tools.html">
            
                    
                    管理员和相关工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="../it-prespective-of-the-platform/policy-based-managment.html">
            
                <a href="../it-prespective-of-the-platform/policy-based-managment.html">
            
                    
                    基于策略的管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="../it-prespective-of-the-platform/app-permission-policy.html">
            
                <a href="../it-prespective-of-the-platform/app-permission-policy.html">
            
                    
                    应用权限策略配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.5" data-path="../it-prespective-of-the-platform/app-setup-policy.html">
            
                <a href="../it-prespective-of-the-platform/app-setup-policy.html">
            
                    
                    应用设置策略
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.6" data-path="../it-prespective-of-the-platform/define-team-template.html">
            
                <a href="../it-prespective-of-the-platform/define-team-template.html">
            
                    
                    定义和分发团队模板
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.7" data-path="../it-prespective-of-the-platform/automation-with-powershell.html">
            
                <a href="../it-prespective-of-the-platform/automation-with-powershell.html">
            
                    
                    使用PowerShell 创建和管理团队
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.8" data-path="../it-prespective-of-the-platform/usage-analytics.html">
            
                <a href="../it-prespective-of-the-platform/usage-analytics.html">
            
                    
                    使用量分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.9" data-path="../it-prespective-of-the-platform/publish-org-apps.html">
            
                <a href="../it-prespective-of-the-platform/publish-org-apps.html">
            
                    
                    发布和管理企业应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.10" data-path="../it-prespective-of-the-platform/power-platform-managment.html">
            
                <a href="../it-prespective-of-the-platform/power-platform-managment.html">
            
                    
                    Power Platform的管理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="./">
            
                <a href="./">
            
                    
                    从开发团队角度看平台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="dev-env-and-tools.html">
            
                <a href="dev-env-and-tools.html">
            
                    
                    开发环境和工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.2" data-path="teams-scenarios-design.html">
            
                <a href="teams-scenarios-design.html">
            
                    
                    应用场景规划和设计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.3" data-path="build-a-qr-code-scan-app.html">
            
                <a href="build-a-qr-code-scan-app.html">
            
                    
                    二维码扫描应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.4" data-path="metionall-in-group-chat.html">
            
                <a href="metionall-in-group-chat.html">
            
                    
                    在群聊中提醒所有人
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.4.5" data-path="bridge-for-parents-and-teachers.html">
            
                <a href="bridge-for-parents-and-teachers.html">
            
                    
                    家校通应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.6" data-path="sso-solution.html">
            
                <a href="sso-solution.html">
            
                    
                    单点登录实现方案
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.7" data-path="multi-languages-support.html">
            
                <a href="multi-languages-support.html">
            
                    
                    多语言支持
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.8" data-path="dark-mode-support.html">
            
                <a href="dark-mode-support.html">
            
                    
                    暗黑模式支持
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.9" data-path="add-the-share-to-teams-button.html">
            
                <a href="add-the-share-to-teams-button.html">
            
                    
                    为你的网站添加“分享到Teams”按钮
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.10" data-path="publish-teams-app-to-the-store.html">
            
                <a href="publish-teams-app-to-the-store.html">
            
                    
                    将Teams应用发布到应用市场
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../opensource-project.html">
            
                <a href="../opensource-project.html">
            
                    
                    开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../feedback-and-follow-update.html">
            
                <a href="../feedback-and-follow-update.html">
            
                    
                    读者反馈
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            本书使用 HonKit 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >家校通应用</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="家校通应用">家校通应用</h1>
<p>这个案例是针对教育行业的场景。现在越来越多的学校（尤其是国际学校），使用Microsoft Teams作为教师和学生日常的沟通，协作，甚至教学的平台。但是，在教育场景中，还有一个角色也很重要，那就是家长。如何构建一个家校沟通的桥梁？这就是我设计本案例的出发点。</p>
<h2 id="需求分析">需求分析</h2>
<p>作为案例分享，我尽可能把需求简化一些。</p>
<p>让我们来设想一下，老师、学生、家长这三个主要角色，他们有什么核心诉求？</p>
<ol>
<li>老师：看到家长留言，并且可以回复。可以发布消息给全体家长。</li>
<li>学生：设置自己的家长信息，查看家长的留言。</li>
<li>家长：了解自己孩子的作业完成情况，得分情况，老师评语等。除此之外，如果能给老师通过留言互动就更好了。</li>
</ol>
<h2 id="应用设计">应用设计</h2>
<p>我们需要考虑到的一个情况是：老师和学生拥有Microsoft Teams账号，他们也比较熟悉怎么使用。但家长是没有账号的，而且他们平常可能完全不用这个软件，他们需要一个特定的界面，并且通过他们熟悉的方式访问。</p>
<p>另外，在 Microsoft Teams for Education 的版本中，老师和学生是按照班级进行分组管理的，每个班级是一个团队，里面可能会有多位老师，和若干个学生—— 跟现实中的学校是一样的。在这个团队中，会根据需要建立多个频道进行日常的沟通和协作。</p>
<p><img src="../.gitbook/assets/图片 426.png" alt></p>
<p>老师可以下发作业，学生可以提交作业，这都是Microsoft Teams内置的功能，本例并不实现这些场景。</p>
<p><img src="../.gitbook/assets/图片 427.png" alt></p>
<p>所以，我们按下面的方式实现</p>
<ol>
<li>这个应用会有几个不同的界面，提供给老师、学生和家长使用。</li>
<li>老师和学生，在对应的班级里面，通过频道选项卡的方式使用。</li>
<li>学生可以决定是否开放信息给家长，并且设置家长信息（邮箱地址）。</li>
<li>家长通过浏览器访问该应用，用他们的邮箱地址进行登录即可。</li>
</ol>
<p>那么，就让我们开始吧。</p>
<h2 id="实现方案">实现方案</h2>
<h3 id="创建项目">创建项目</h3>
<p>我们将继续用Node.js来构建这个范例应用，而且不使用复杂的模板，尽可能用最原生态的方式，让大家了解细节。</p>
<blockquote>
<p>请确保你认真阅读了本章第一节有关“ 开发环境和工具”的介绍。</p>
</blockquote>
<pre><code>npx create-react-app eduapp --template typescript
</code></pre><p>安装几个必要的模块</p>
<pre><code>yarn add @microsoft/teams-js @fluentui/react-northstar react-router-dom
yarn add @types/react-router-dom -D
</code></pre><p>创建api目录，用Azure function core tools初始化一个服务项目，并且安装必要的模块</p>
<pre><code>mkdir api
cd api
func init --language typescript --work-runtime node
func new -l typescript -n service -t &quot;http trigger&quot; -a anonymous
yarn add node-fetch lowdb uuid
yarn add @types/lowdbn @types/uuid -D
</code></pre><p>现在这个项目，在VS Code中看起来是下面这样的</p>
<p><img src="../.gitbook/assets/图片 428.png" alt></p>
<p>配置前端项目和服务项目的连接，在项目根目录下面的package.json中添加一行配置</p>
<pre><code>&quot;proxy&quot;: &quot;http://localhost:7071&quot;,
</code></pre><p>分别在根目录，和api 目录，运行下面的命令，将应用启动起来</p>
<pre><code>yarn start
</code></pre><p>在VS Code中看起来是下面这样的</p>
<p><img src="../.gitbook/assets/图片 429.png" alt></p>
<p>在浏览器中，默认打开了 <a href="http://localhost:3000" target="_blank">http://localhost:3000</a> 这个地址，你可以看到一个简单的应用界面</p>
<p><img src="../.gitbook/assets/图片 430.png" alt></p>
<p>先不要着急。这只是React 应用的初始界面，我们很快就会进行修改。接下来你可以用 ngrok 为这个应用做外部隧道处理。</p>
<pre><code>ngrok http 3000 --host-header=rewrite
</code></pre><p><img src="../.gitbook/assets/图片 431.png" alt></p>
<p>通过App Studio创建一个范例应用，并为其定义一个“Team tab”</p>
<p><img src="../.gitbook/assets/图片 433.png" alt></p>
<p>这个Team tab的详细页面中，将configuration URL 设置为 <code>你的网站根目录/config</code> ，类似下面这样</p>
<p><img src="../.gitbook/assets/图片 432.png" alt></p>
<p>一切都准备就绪了，我们下面就专注于写代码实现吧。</p>
<h3 id="实现可配置的选项卡">实现可配置的选项卡</h3>
<p>修改项目的App.tsx文件，根据需求，我们设计了三个不同的路由，分别代表家长端界面，老师和学生端界面，以及在Teams中的一个配置界面。</p>
<p>我们同时简单地实现了一个配置的功能。</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { BrowserRouter <span class="hljs-keyword">as</span> Router, Route } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;
<span class="hljs-keyword">import</span> { Provider, teamsTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@fluentui/react-northstar&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> microsoftTeams <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@microsoft/teams-js&quot;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Parent</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>家校通,家长端<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Tab</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>家校通,老师和学生端，这里会根据不同的用户身份显示不同的内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>

}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Configuration</span>(<span class="hljs-params"></span>) </span>{

  microsoftTeams.settings.setValidityState(<span class="hljs-literal">true</span>);
  microsoftTeams.settings.registerOnSaveHandler(<span class="hljs-function"><span class="hljs-params">evt</span> =&gt;</span> {
    microsoftTeams.settings.setSettings({
      <span class="hljs-attr">entityId</span>: <span class="hljs-string">&quot;eduapp&quot;</span>,<span class="hljs-comment">//这个id，在真实的项目开发中，需要考虑设计成一个唯一性的字段，因为用户可以在任何团队和频道添加你这个选项卡，即便是同一个频道，也可以添加多次，那么如何进行区分呢？这个id 很重要。</span>
      <span class="hljs-attr">websiteUrl</span>: <span class="hljs-string">&quot;https://2adeb3f8ee53.ngrok.io&quot;</span>,<span class="hljs-comment">//在Teams中的选项卡，除了可以在Teams中打开外，还可以在浏览器中打开。如果在浏览器中打开，会调用这个地址。</span>
      <span class="hljs-attr">contentUrl</span>: <span class="hljs-string">&quot;https://2adeb3f8ee53.ngrok.io/tab&quot;</span>,<span class="hljs-comment">//这是在Teams里面打开的地址。如果要区分不同的选项卡实例，可以考虑在这个地址后面添加参数。</span>
      <span class="hljs-attr">suggestedDisplayName</span>: <span class="hljs-string">&quot;家校通&quot;</span><span class="hljs-comment">//这是推荐给用户的选项卡名称</span>
    });


    evt.notifySuccess();
  })

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>家校通应用<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这个页面用来让用户进行配置，通常来说，这里会有一些可以配置的选项，然后根据选项的值，决定用户是否可以点击“保存”按钮，点击“保存”按钮时，会调用有关的接口，进行保存操作，并且通知客户端关闭当前的配置窗口。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>{
  microsoftTeams.initialize();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">{teamsTheme}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Parent}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/config&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Configuration}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/tab&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Tab}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<p>你现在可以尝试在Teams中把这个应用安装起来，当你把它添加到一个团队（这意味着是一个班级），它会默认弹出来一个对话框，这里将加载我们设计好的配置页面，如下所示</p>
<p><img src="../.gitbook/assets/图片 434.png" alt></p>
<p>点击 “保存”以后，这个选项卡就会显示出来。</p>
<p><img src="../.gitbook/assets/图片 435.png" alt></p>
<p>而如果你直接访问当前这个网站的根目录，那么将显示下面的效果，也就是我们计划用来给家长提供功能的界面（目前还没有具体实现）。</p>
<p><img src="../.gitbook/assets/图片 436.png" alt></p>
<p>看起来还不错，虽然界面比较简陋，但核心功能已经能看到了。下面我们就是逐一进行实现这三种角色的功能需求。</p>
<h3 id="实现学生功能">实现学生功能</h3>
<p>这里会有一个关键问题，就是如何区分学生和老师？不同的学校做法可能不太一样，但通常都是把老师设置为团队的管理员，而学生只是一般的成员。</p>
<p><img src="../.gitbook/assets/图片 437.png" alt></p>
<p>作为案例演示目的，简单起见，我就使用这个角色来判断老师和学生吧。但要注意，这样做其实不是很安全，后续请参考有关单点登录实现方案。</p>
<p><a href="sso-solution.html">sso-solution.md</a></p>
<p>修改Tab 这个函数，这个界面会根据当前用户的角色来切换老师和学生这两个组件。</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Tab</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">const</span> [context, setContext] = useState&lt;microsoftTeams.Context&gt;();<span class="hljs-comment">//当前Teams上下文</span>

  useEffect(<span class="hljs-function">() =&gt;</span> {
    microsoftTeams.getContext(<span class="hljs-function"><span class="hljs-params">ctx</span> =&gt;</span> {
      setContext(ctx);
    })
  }, [])

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {context &amp;&amp; context.userObjectId &amp;&amp; context.groupId &amp;&amp; context.userPrincipalName ?
        (context.userTeamRole ?
          <span class="hljs-tag">&lt;<span class="hljs-name">Student</span> <span class="hljs-attr">studentId</span>=<span class="hljs-string">{context.userObjectId}</span> <span class="hljs-attr">studentName</span>=<span class="hljs-string">{context.userPrincipalName.split(</span>&apos;@&apos;)[<span class="hljs-attr">0</span>]} <span class="hljs-attr">classId</span>=<span class="hljs-string">{context.groupId}</span> /&gt;</span> :
          <span class="hljs-tag">&lt;<span class="hljs-name">Teacher</span> <span class="hljs-attr">teacherName</span>=<span class="hljs-string">{context.userPrincipalName.split(</span>&apos;@&apos;)[<span class="hljs-attr">0</span>]} <span class="hljs-attr">teacherId</span>=<span class="hljs-string">{context.userObjectId}</span> <span class="hljs-attr">classId</span>=<span class="hljs-string">{context.groupId}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Teacher</span>&gt;</span>)
        : <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>正在加载...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      }
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )

}
</code></pre>
<p>使用下面的代码实现Student这个组件，用来展示学生的页面</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Student</span>(<span class="hljs-params">props: { studentId: string, studentName: string, classId: string }</span>) </span>{

  <span class="hljs-keyword">const</span> [settings, setSettings] = useState&lt;[any]&gt;();
  <span class="hljs-keyword">const</span> [inputName, setInputName] = useState&lt;string&gt;();
  <span class="hljs-keyword">const</span> [selectedType, setSelectedType] = useState&lt;string&gt;();

  useEffect(<span class="hljs-function">() =&gt;</span> {
    fetch(<span class="hljs-string">`api/service?call=getParentInfoById&amp;id=<span class="hljs-subst">${props.studentId}</span>`</span>).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.json()).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> setSettings(x));
  }, [])

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Flex</span> <span class="hljs-attr">column</span> <span class="hljs-attr">fill</span> <span class="hljs-attr">gap</span>=<span class="hljs-string">&quot;gap.medium&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Segment</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;brand&quot;</span> <span class="hljs-attr">inverted</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Flex</span> <span class="hljs-attr">column</span> <span class="hljs-attr">fill</span> <span class="hljs-attr">gap</span>=<span class="hljs-string">&quot;gap.small&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">content</span>=<span class="hljs-string">{</span>`你好,${<span class="hljs-attr">props.studentName</span>}`} <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;larger&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;在这里你可以设置家长信息，你需要输入邮箱地址，和选择称谓。你设置的家长，可以通过邮箱登录到家校通（网页版），然后可以查看你所在班级的作业及老师批改情况，并且可以跟你所在班级的老师进行留言互动。&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;small&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Flex</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Segment</span>&gt;</span>

      {settings &amp;&amp; settings.length &gt; 0 &amp;&amp;
        <span class="hljs-tag">&lt;<span class="hljs-name">Segment</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>已经添加的家长<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">items</span>=<span class="hljs-string">{settings?.map((x:</span> <span class="hljs-attr">any</span>) =&gt;</span> {
            return {
              key: x.email,
              header: x.type,
              content: x.email
            }
          })}&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">List</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Segment</span>&gt;</span>
      }
      <span class="hljs-tag">&lt;<span class="hljs-name">Segment</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>添加新的家长<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Form</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginLeft:</span> <span class="hljs-attr">20</span> }}
          <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{()</span> =&gt;</span> {
            const data = {
              id: props.studentId,
              student: props.studentName,
              type: selectedType,
              email: inputName,
              class: props.classId
            };
            //调用接口提交数据
            fetch(&quot;api/service?call=addParentInfo&quot;, {
              method: &quot;post&quot;,
              body: JSON.stringify(data)
            }).then(x =&gt; {
              let temp = settings;
              temp?.push(data);
              setSettings(temp);
            })
          }}
        &gt;

          <span class="hljs-tag">&lt;<span class="hljs-name">FormInput</span>
            <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;家长邮箱&quot;</span>
            <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;firstName&quot;</span>
            <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;first-name&quot;</span>
            <span class="hljs-attr">required</span>
            <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">{inputName}</span>
            <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(evt,</span> <span class="hljs-attr">data</span>) =&gt;</span> {
              setInputName(data?.value)
            }}
          /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">FormDropdown</span>
            <span class="hljs-attr">items</span>=<span class="hljs-string">{[</span>&apos;爸爸&apos;, &apos;妈妈&apos;, &apos;爷爷&apos;, &apos;奶奶&apos;, &apos;外公&apos;, &apos;外婆&apos;, &apos;其他&apos;]}
            <span class="hljs-attr">search</span>=<span class="hljs-string">{true}</span>
            <span class="hljs-attr">autoSize</span>=<span class="hljs-string">{false}</span>
            <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;选择家长称谓&quot;</span>
            <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">{selectedType}</span>
            <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(evt,</span> <span class="hljs-attr">data</span>) =&gt;</span> {
              if (data.value) {
                setSelectedType(data.value as string);
              }
            }}
          /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">FormButton</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;提交&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Form</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Segment</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Flex</span>&gt;</span></span>)
}
</code></pre>
<p>我们需要提供两个API方法来实现学生配置信息的读写。为了简单起见，我将所有的API方法都写在api目录下面的 service目录下面的index.ts文件中，并且根据传入参数的call来判断是要调用什么方法。另外，这里使用了一个简单的json文件来保存数据。有兴趣请参考 <code>lowdb</code> 这个模块的官方说明。</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { AzureFunction, Context, HttpRequest } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@azure/functions&quot;</span>;


<span class="hljs-keyword">const</span> httpTrigger: AzureFunction = <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context: Context, req: HttpRequest</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span>&gt; </span>{
    <span class="hljs-keyword">const</span> FileSync = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;lowdb/adapters/FileSync&quot;</span>);
    <span class="hljs-keyword">const</span> lowdb = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;lowdb&quot;</span>);
    <span class="hljs-keyword">const</span> adapter = <span class="hljs-keyword">new</span> FileSync(<span class="hljs-string">&quot;./data.json&quot;</span>);
    <span class="hljs-keyword">const</span> db = lowdb(adapter);
    db.defaults({ <span class="hljs-attr">studentSettings</span>: [] }).write();



    <span class="hljs-comment">//这个接口用来模拟服务调用</span>
    <span class="hljs-keyword">let</span> responseMessage = {};
    <span class="hljs-comment">// 学生相关</span>
    <span class="hljs-comment">//1. 读取家长信息（姓名，邮箱，称谓） GET, getParentInfoById</span>
    <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;get&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;getParentInfoById&quot;</span> &amp;&amp; req.query.id) {
        responseMessage = db.get(<span class="hljs-string">&quot;studentSettings&quot;</span>).filter({ <span class="hljs-attr">id</span>: req.query.id }).value()
    }

    <span class="hljs-comment">//2. 保存家长信息（姓名，邮箱，称谓） POST,addParentInfo</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;post&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;addParentInfo&quot;</span>) {
        db.get(<span class="hljs-string">&quot;studentSettings&quot;</span>).push(<span class="hljs-built_in">JSON</span>.parse(req.rawBody)).write();
        responseMessage = {
            <span class="hljs-attr">body</span>: <span class="hljs-string">&quot;保存成功&quot;</span>
        }
    }

    <span class="hljs-comment">// 老师相关</span>


    <span class="hljs-comment">// 家长相关</span>

    context.res = {
        <span class="hljs-comment">// status: 200, /* Defaults to 200 */</span>
        <span class="hljs-attr">body</span>: responseMessage
    };

};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> httpTrigger;
</code></pre>
<p>保存以上代码，如果你之前已经运行了项目，它将自动再次编译，此时尝试用一个学生的账号去打开应用，如下图所示。</p>
<p><img src="../.gitbook/assets/图片 438.png" alt></p>
<p>用户可以添加一个或多个家长信息，如下所示</p>
<p><img src="../.gitbook/assets/图片 439.png" alt></p>
<p>后台数据大致是下面这样的</p>
<pre><code class="lang-javascript"><span class="hljs-string">&quot;studentSettings&quot;</span>: [
  {
    <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;4e0ea706-6806-4cd3-ad63-e42daab30b5d&quot;</span>,
    <span class="hljs-string">&quot;student&quot;</span>: <span class="hljs-string">&quot;AshleyK&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;爸爸&quot;</span>,
    <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;dad@code365.xyz&quot;</span>,
    <span class="hljs-string">&quot;class&quot;</span>: <span class="hljs-string">&quot;64612a03-d205-4045-ae76-7c9f6e5006b1&quot;</span>
  },
  {
    <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;4e0ea706-6806-4cd3-ad63-e42daab30b5d&quot;</span>,
    <span class="hljs-string">&quot;student&quot;</span>: <span class="hljs-string">&quot;AshleyK&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;妈妈&quot;</span>,
    <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;mon@code365.xyz&quot;</span>,
    <span class="hljs-string">&quot;class&quot;</span>: <span class="hljs-string">&quot;64612a03-d205-4045-ae76-7c9f6e5006b1&quot;</span>
  }
],
</code></pre>
<p>我们这里不准备实现更加复杂的验证逻辑，以及细节的管理功能，例如删除或修改家长信息等。下面我们尝试来实现老师端的功能。</p>
<h3 id="实现老师功能">实现老师功能</h3>
<p>我们为老师实现的核心功能，主要包括</p>
<ol>
<li>老师可以给班级所有家长发公告消息</li>
<li>老师可以看到家长回复的消息（针对某个公告消息）</li>
</ol>
<p>首先，为了能执行这些操作，我添加了几个后台服务方法，如下面所示</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { AzureFunction, Context, HttpRequest } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@azure/functions&quot;</span>;
<span class="hljs-keyword">import</span> { v4 } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;uuid&quot;</span>;

<span class="hljs-keyword">const</span> httpTrigger: AzureFunction = <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context: Context, req: HttpRequest</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">void</span>&gt; </span>{
    <span class="hljs-keyword">const</span> FileSync = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;lowdb/adapters/FileSync&quot;</span>);
    <span class="hljs-keyword">const</span> lowdb = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;lowdb&quot;</span>);
    <span class="hljs-keyword">const</span> adapter = <span class="hljs-keyword">new</span> FileSync(<span class="hljs-string">&quot;./data.json&quot;</span>);
    <span class="hljs-keyword">const</span> db = lowdb(adapter);

    db.defaults({ <span class="hljs-attr">studentSettings</span>: [], <span class="hljs-attr">posts</span>: [], <span class="hljs-attr">comments</span>: [] }).write();

    <span class="hljs-comment">//这个接口用来模拟服务调用</span>
    <span class="hljs-keyword">let</span> responseMessage = {};
    <span class="hljs-comment">// 学生相关</span>
    <span class="hljs-comment">//1. 读取家长信息（姓名，邮箱，称谓） GET, getParentInfoById</span>
    <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;get&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;getParentInfoById&quot;</span> &amp;&amp; req.query.id) {
        responseMessage = db.get(<span class="hljs-string">&quot;studentSettings&quot;</span>).filter({ <span class="hljs-attr">id</span>: req.query.id }).value()
    }

    <span class="hljs-comment">//2. 保存家长信息（姓名，邮箱，称谓） POST,addParentInfo</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;post&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;addParentInfo&quot;</span>) {
        db.get(<span class="hljs-string">&quot;studentSettings&quot;</span>).push(<span class="hljs-built_in">JSON</span>.parse(req.rawBody)).write();
        responseMessage = {
            <span class="hljs-attr">body</span>: <span class="hljs-string">&quot;保存成功&quot;</span>
        }
    }

    <span class="hljs-comment">// 老师相关</span>
    <span class="hljs-comment">//1. 发送公告消息</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;post&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;addpost&quot;</span>) {
        <span class="hljs-keyword">const</span> data = <span class="hljs-built_in">JSON</span>.parse(req.rawBody);
        db.get(<span class="hljs-string">&quot;posts&quot;</span>).push({
            <span class="hljs-attr">id</span>: v4(),
            <span class="hljs-attr">teacherId</span>: data.teacherId,
            <span class="hljs-attr">content</span>: data.content,
            <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleString()
        }).write();

    }
    <span class="hljs-comment">//2. 读取某个老师发布的公告列表</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;get&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;getmyposts&quot;</span> &amp;&amp; req.query.id) {
        responseMessage = db.get(<span class="hljs-string">&quot;posts&quot;</span>).filter({ <span class="hljs-attr">teacherId</span>: req.query.id }).value();
    }

    <span class="hljs-comment">//3. 获取某个公告的评论</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;get&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;getcommentsbypost&quot;</span> &amp;&amp; req.query.id) {
        responseMessage = db.get(<span class="hljs-string">&quot;comments&quot;</span>).filter({ <span class="hljs-attr">postId</span>: req.query.id }).value();
    }

    <span class="hljs-comment">// 家长相关</span>

    context.res = {
        <span class="hljs-comment">// status: 200, /* Defaults to 200 */</span>
        <span class="hljs-attr">body</span>: responseMessage
    };

};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> httpTrigger;
</code></pre>
<p>在前端应用中，我为老师组件设计了如下的界面和逻辑</p>
<pre><code class="lang-jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Teacher</span>(<span class="hljs-params">props: { teacherId: string, teacherName: string, classId: string }</span>) </span>{
  <span class="hljs-keyword">const</span> [posts, setPosts] = useState&lt;[any]&gt;();

  useEffect(<span class="hljs-function">() =&gt;</span> {
    fetch(<span class="hljs-string">`api/service?call=getmyposts&amp;id=<span class="hljs-subst">${props.teacherId}</span>`</span>).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.json()).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> setPosts(x));
  }, [])

  <span class="hljs-comment">// 评论组件</span>
  <span class="hljs-keyword">const</span> Comment = <span class="hljs-function">(<span class="hljs-params">props: { postId: string }</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> [comments, setComments] = useState&lt;[any]&gt;();
    useEffect(<span class="hljs-function">() =&gt;</span> {
      fetch(<span class="hljs-string">`api/service?call=getcommentsbypost&amp;id=<span class="hljs-subst">${props.postId}</span>`</span>).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.json()).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> setComments(x));

    }, [])

    <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {
        comments ?
          <span class="hljs-tag">&lt;<span class="hljs-name">List</span>
            <span class="hljs-attr">items</span>=<span class="hljs-string">{</span>
              <span class="hljs-attr">comments</span>?<span class="hljs-attr">.map</span>(<span class="hljs-attr">x</span> =&gt;</span> {
                return {
                  key: x.id,
                  header: x.comment,
                  content: `${x.author} 发表于 ${x.time}`
                }
              })
            }&gt;&lt;/List &gt;
          : &quot;&quot;}
    <span class="hljs-tag">&lt;/&gt;</span>)
  }

  return (
    <span class="hljs-tag">&lt;<span class="hljs-name">Flex</span> <span class="hljs-attr">column</span> <span class="hljs-attr">fill</span> <span class="hljs-attr">gap</span>=<span class="hljs-string">&quot;gap.medium&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Segment</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;brand&quot;</span> <span class="hljs-attr">inverted</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Flex</span> <span class="hljs-attr">column</span> <span class="hljs-attr">fill</span> <span class="hljs-attr">gap</span>=<span class="hljs-string">&quot;gap.small&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">content</span>=<span class="hljs-string">{</span>`你好,${<span class="hljs-attr">props.teacherName</span>}`} <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;larger&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;这是家校通的老师界面，在这里你可以发布公告，并且也可以查看家长的回复&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;small&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Flex</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Segment</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">Segment</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>发布公告<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Form</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginLeft:</span> <span class="hljs-attr">20</span> }}
          <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{(evt)</span> =&gt;</span> {
            const text = (evt.target as any).txtcomment.value;
            fetch(&quot;api/service?call=addpost&quot;, {
              method: &quot;post&quot;,
              body: JSON.stringify({
                teacherId: props.teacherId,
                content: text
              })
            }).then(_ =&gt; {
              (evt.target as any).txtcomment.value = &quot;&quot;;
            })
          }}
        &gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">FormTextArea</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">600</span> }} <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;txtcomment&quot;</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">FormButton</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;发布&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">FormButton</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Form</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Segment</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">Segment</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>公告列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">items</span>=<span class="hljs-string">{posts?.map((x:</span> <span class="hljs-attr">any</span>) =&gt;</span> {
          return {
            key: x.id,
            header: <span class="hljs-tag">&lt;&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{x.content}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>发布于: {x.time}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/&gt;</span>,
            content: <span class="hljs-tag">&lt;<span class="hljs-name">Comment</span> <span class="hljs-attr">postId</span>=<span class="hljs-string">{x.id}</span> /&gt;</span>
          }
        })}&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">List</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Segment</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Flex</span>&gt;</span>
  )
}
</span></code></pre>
<p>这个界面效果，用一个老师的帐号登录可以看到，大致如下</p>
<p><img src="../.gitbook/assets/图片 441.png" alt></p>
<h3 id="实现家长功能">实现家长功能</h3>
<p>终于到了这个案例最有意思，也最有挑战的一个部分了，家校通主要是为了打通学校和家庭，让家长能了解到必要的信息，并且可以跟老师进行互动，而且最好是让家长用他们最方便的形式来进行操作。</p>
<p>目前这一版的设计，我们是假定家长没有Microsoft Teams账号，他们将使用自己的手机或电脑，通过网页的形式打开“家校通” 的主页，在主页上可以方便地了解子女的作业完成情况，还可以收到老师发出的公告，并且进行互动留言。</p>
<p>未来也可以考虑让家长使用免费的Microsoft Teams参与家校互动。</p>
<p>家长需要了解子女的作业完成情况，这个可以通过Microsoft Graph的接口实现。但这里还是要请大家注意，因为这些信息是学校和学生自己的数据，所以必须由学校授权才能开放给家长，我在本案例中，特别添加的一个环节——让学生主动添加自己家长（意味着授权家长可以查看自己的作业），则是从尊重每个用户的隐私和权利这个角度的考量。</p>
<p>如果我们知道一个班级的编号，我们就能查询到对应的作业信息，这个接口的文档如下</p>
<p><a href="https://docs.microsoft.com/en-us/graph/api/resources/educationassignment?view=graph-rest-beta" target="_blank">https://docs.microsoft.com/en-us/graph/api/resources/educationassignment?view=graph-rest-beta</a></p>
<blockquote>
<p>目前这些接口出于beta阶段。</p>
</blockquote>
<p>如果通过Graph Explorer这个工具，你可以用如下的查询语法来验证一下数据</p>
<pre><code>https://graph.microsoft.com/beta/education/classes/64612a03-d205-4045-ae76-7c9f6e5006b1/assignments?$filter=status eq &apos;assigned&apos;&amp;$select=displayname,duedatetime,assigneddatetime,id,grading,instructions
</code></pre><p><img src="../.gitbook/assets/图片 445.png" alt></p>
<p>那么，如何获取某个作业的已交作业呢？请参考下面这样的查询语法</p>
<pre><code>https://graph.microsoft.com/beta/education/classes/64612a03-d205-4045-ae76-7c9f6e5006b1/assignments/b7293bdf-9534-487b-b04c-e235830fb4ce/submissions?$select=id,status,submittedBy
</code></pre><p><img src="../.gitbook/assets/图片 443.png" alt></p>
<p>如果要查看某个作业，老师批改之后的打分，以及评语，请参考下面这样的查询语法</p>
<pre><code>https://graph.microsoft.com/beta/education/classes/64612a03-d205-4045-ae76-7c9f6e5006b1/assignments/b7293bdf-9534-487b-b04c-e235830fb4ce/submissions/b8da4b62-5aba-baa4-6f50-8814fd29faea/outcomes
</code></pre><p><img src="../.gitbook/assets/图片 444.png" alt></p>
<p>以上我们通过Graph Explorer来查询，是很方便的，而在家校通应用中，如果需要访问这些数据，还需要先在Azure AD中注册一个应用程序，并且申请必要的的权限。</p>
<p><img src="../.gitbook/assets/图片 446.png" alt></p>
<p>点击“注册”后，为该应用程序添加一个密码</p>
<p><img src="../.gitbook/assets/图片 447.png" alt></p>
<p>请注意，你需要把这个密码复制保存起来，因为你只有一次机会看到这个密码。接下来为该应用申请权限。请注意，这里需要申请“应用程序” 这个类型的权限。</p>
<p><img src="../.gitbook/assets/图片 448.png" alt></p>
<p>作为管理员，你必须授予管理员同意，这样一会儿我们自己的那个服务（api/service）才可以直接访问这些接口。</p>
<p>最后，你需要复制应用程序编号，租户编号等信息，如下所示</p>
<p><img src="../.gitbook/assets/图片 449.png" alt></p>
<p>回到VS Code中来，把上面三个信息（应用程序编号，租户编号，密码），保存在 api目录下面的.env文件中。如果该文件不存在，则新建这个文件。</p>
<p><img src="../.gitbook/assets/图片 450.png" alt></p>
<p>为api 这个项目，添加如下的模块, 用来进行身份验证并且调用Graph的接口。</p>
<pre><code>yarn add @azure/msal-node @microsoft/microsoft-graph-client isomorphic-fetch dotenv
</code></pre><p>在 <code>index.ts</code> 文件中，导入了如下对象</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> msal <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@azure/msal-node&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> graph <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@microsoft/microsoft-graph-client&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;isomorphic-fetch&quot;</span>;
</code></pre>
<p>添加了如下的一个方法</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">const</span> getGraphClient = <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;graph.Client&gt; =&gt; {
    <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;dotenv&quot;</span>).config();
    <span class="hljs-keyword">const</span> cca = <span class="hljs-keyword">new</span> msal.ConfidentialClientApplication({
        <span class="hljs-attr">auth</span>: {
            <span class="hljs-attr">clientId</span>: process.env.clientId,
            <span class="hljs-attr">clientSecret</span>: process.env.clientSecret,
            <span class="hljs-attr">authority</span>: <span class="hljs-string">`https://login.microsoftonline.com/<span class="hljs-subst">${process.env.tenantId}</span>`</span>
        }
    });

    <span class="hljs-keyword">const</span> tokenResponse = <span class="hljs-keyword">await</span> cca.acquireTokenByClientCredential({
        <span class="hljs-attr">scopes</span>: [<span class="hljs-string">&quot;https://graph.microsoft.com/.default&quot;</span>]
    });


    <span class="hljs-keyword">const</span> client = graph.Client.init({
        <span class="hljs-attr">authProvider</span>: <span class="hljs-function">(<span class="hljs-params">done</span>) =&gt;</span> {
            done(<span class="hljs-literal">null</span>, tokenResponse.accessToken);
        }
    });
    <span class="hljs-keyword">return</span> client;
}
</code></pre>
<p>然后分别定义了三个函数来对应上面我们提到过的三个接口请求（获取作业，获取作业提交，获取作业批改数据），分别如下</p>
<pre><code class="lang-typescript"><span class="hljs-comment">//2. 获取某个班级的所有已下发的作业</span>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;get&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;getassignmentsbyclass&quot;</span> &amp;&amp; req.query.id) {
    <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">await</span> getGraphClient();
    responseMessage = <span class="hljs-keyword">await</span> client
        .api(<span class="hljs-string">`/education/classes/<span class="hljs-subst">${req.query.id}</span>/assignments?$filter=status eq &apos;assigned&apos;&amp;$select=displayname,duedatetime,assigneddatetime,id,grading,instructions`</span>)
        .version(<span class="hljs-string">&quot;beta&quot;</span>)
        .get()
}
</code></pre>
<p>这个代码分支，通过浏览器直接进行测试，可以得到如下的效果</p>
<p><img src="../.gitbook/assets/图片 451.png" alt></p>
<p>下面的获取作业的提交数据</p>
<pre><code class="lang-typescript"><span class="hljs-comment">//3. 获取某个作业的提交情况</span>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;get&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;getsubmissionsbyassignment&quot;</span> &amp;&amp; req.query.id &amp;&amp; req.query.class) {
    <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">await</span> getGraphClient();
    responseMessage = <span class="hljs-keyword">await</span> client
        .api(<span class="hljs-string">`/education/classes/<span class="hljs-subst">${req.query.<span class="hljs-keyword">class</span>}</span>/assignments/<span class="hljs-subst">${req.query.id}</span>/submissions?$select=id,status,submittedBy`</span>)
        .version(<span class="hljs-string">&quot;beta&quot;</span>)
        .get();
}
</code></pre>
<p>这个代码分支，通过浏览器直接进行测试，可以得到如下的效果</p>
<p><img src="../.gitbook/assets/图片 452.png" alt></p>
<p>最后是获取某个学生提交后，老师的批改信息</p>
<pre><code class="lang-typescript"><span class="hljs-comment">//4. 获取某个学生提交后，老师的批改信息</span>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;get&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;getsubmissionoutcome&quot;</span> &amp;&amp; req.query.id &amp;&amp; req.query.class &amp;&amp; req.query.assignment) {
    <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">await</span> getGraphClient();
    responseMessage = <span class="hljs-keyword">await</span> client
        .api(<span class="hljs-string">`/education/classes/<span class="hljs-subst">${req.query.<span class="hljs-keyword">class</span>}</span>/assignments/<span class="hljs-subst">${req.query.assignment}</span>/submissions/<span class="hljs-subst">${req.query.id}</span>/outcomes`</span>)
        .version(<span class="hljs-string">&quot;beta&quot;</span>)
        .get();
}
</code></pre>
<p>这个代码分支，通过浏览器直接进行测试，可以得到如下的效果</p>
<p><img src="../.gitbook/assets/图片 453.png" alt></p>
<p>最后，我还添加了一个方法，用来读取班级公告。</p>
<pre><code class="lang-typescript"><span class="hljs-comment">//5. 获取某个班级的公告</span>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;get&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;getpostsbyclass&quot;</span> &amp;&amp; req.query.id) {
    responseMessage = db.get(<span class="hljs-string">&quot;posts&quot;</span>).filter({ <span class="hljs-attr">class</span>: req.query.id }).value();
}
</code></pre>
<p>以及根据家长邮箱获取相关孩子和班级信息</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// 1. 根据email获取孩子和班级信息</span>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method.toLowerCase() === <span class="hljs-string">&quot;get&quot;</span> &amp;&amp; req.query.call === <span class="hljs-string">&quot;getParentInfoByEmail&quot;</span> &amp;&amp; req.query.email) {
    responseMessage = db.get(<span class="hljs-string">&quot;studentSettings&quot;</span>).filter({ <span class="hljs-attr">email</span>: req.query.email }).value()
}
</code></pre>
<p>现在后台的服务就全部写好了，我们来看看前端的实现吧。下面是完整实现的Parent这个组件的代码，里面包含了几个子组件，如作业列表，作业状态，公告列表，评论等。为了简单起见，我全部放在一个大的组件里面了，正常开发时，可以分多个文件来保存。</p>
<pre><code class="lang-typescript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Parent</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> [parentInfo, setParentInfo] = useState&lt;[<span class="hljs-built_in">any</span>]&gt;();<span class="hljs-comment">//家长信息</span>



  useEffect(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">//默认尝试去加载localstorage里面的数据，并且从服务器刷新一次数据</span>
    <span class="hljs-keyword">const</span> email = <span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&quot;parentEmail&quot;</span>);
    <span class="hljs-keyword">if</span> (email) {
      fetch(<span class="hljs-string">`api/service?call=getParentInfoByEmail&amp;email=<span class="hljs-subst">${email}</span>`</span>).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.json()).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> {
        setParentInfo(x);
      });
    }
  }, []);


  <span class="hljs-comment">// 作业列表组件</span>
  <span class="hljs-keyword">const</span> AssignmentList = <span class="hljs-function">(<span class="hljs-params">props: { <span class="hljs-keyword">class</span>: <span class="hljs-built_in">string</span>, student: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> [assignments, setAssignments] = useState&lt;[<span class="hljs-built_in">any</span>]&gt;();<span class="hljs-comment">//作业列表</span>


    <span class="hljs-keyword">const</span> AssignmentStatus = <span class="hljs-function">(<span class="hljs-params">props: { id: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">class</span>: <span class="hljs-built_in">string</span>, student: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> [status, setStatus] = useState&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&quot;正在检索状态&quot;</span>);

      useEffect(<span class="hljs-function">() =&gt;</span> {
        fetch(<span class="hljs-string">`api/service?call=getsubmissionsbyassignment&amp;class=<span class="hljs-subst">${props.<span class="hljs-keyword">class</span>}</span>&amp;id=<span class="hljs-subst">${props.id}</span>&amp;student=<span class="hljs-subst">${props.student}</span>`</span>)
          .then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.json())
          .then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (x.value &amp;&amp; x.value.length &gt; <span class="hljs-number">0</span>) {
              <span class="hljs-comment">//这个学生有提交作业</span>
              <span class="hljs-keyword">const</span> submissionId = x.value[<span class="hljs-number">0</span>].id;
              fetch(<span class="hljs-string">`api/service?call=getsubmissionoutcome&amp;class=<span class="hljs-subst">${props.<span class="hljs-keyword">class</span>}</span>&amp;assignment=<span class="hljs-subst">${props.id}</span>&amp;id=<span class="hljs-subst">${submissionId}</span>`</span>).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.json()).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> {
                <span class="hljs-keyword">if</span> (x.value &amp;&amp; x.value.length &gt; <span class="hljs-number">0</span>) {
                  <span class="hljs-keyword">let</span> feedback, point;

                  x.value.forEach(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
                    <span class="hljs-keyword">if</span> (item.feedback) {
                      feedback = item.feedback.text.content;
                    }

                    <span class="hljs-keyword">if</span> (item.points) {
                      point = item.points.points;
                    }
                  });

                  setStatus(<span class="hljs-string">`作业已提交,得分:<span class="hljs-subst">${point}</span>,老师评语:<span class="hljs-subst">${feedback ?? <span class="hljs-string">&apos;无&apos;</span>}</span>`</span>);
                }
                <span class="hljs-keyword">else</span>
                  setStatus(<span class="hljs-string">&quot;作业已提交，但老师还没有批改&quot;</span>);
              });
            }
            <span class="hljs-keyword">else</span>
              setStatus(<span class="hljs-string">&quot;当前还没有提交作业&quot;</span>);
          })
      }, []);

      <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{status}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)
    }
    useEffect(<span class="hljs-function">() =&gt;</span> {
      fetch(<span class="hljs-string">`api/service?call=getassignmentsbyclass&amp;id=<span class="hljs-subst">${props.<span class="hljs-keyword">class</span>}</span>`</span>).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.json()).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> setAssignments(x.value));
    }, [])
    <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">items</span>=<span class="hljs-string">{</span>
      <span class="hljs-attr">assignments</span>?<span class="hljs-attr">.map</span>(<span class="hljs-attr">x</span> =&gt;</span> {
        return {
          key: x.id,
          header: <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{x.displayName}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>,
          content: <span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{`发布日期:${x.assignedDateTime},截止日期:${x.dueDateTime}, 总分:${x.grading.maxPoints}`}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">AssignmentStatus</span> <span class="hljs-attr">class</span>=<span class="hljs-string">{props.class}</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{x.id}</span> <span class="hljs-attr">student</span>=<span class="hljs-string">{props.student}</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span>
          <span class="hljs-tag">&lt;/&gt;</span></span>
        }
      })
    }&gt;&lt;/List&gt;)
  }

  <span class="hljs-comment">//公告列表组件</span>
  <span class="hljs-keyword">const</span> PostList = <span class="hljs-function">(<span class="hljs-params">props: { <span class="hljs-keyword">class</span>: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> [posts, setPosts] = useState&lt;[<span class="hljs-built_in">any</span>]&gt;();<span class="hljs-comment">//公告</span>

    <span class="hljs-keyword">const</span> Comment = <span class="hljs-function">(<span class="hljs-params">props: { postId: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> [comments, setComments] = useState&lt;[<span class="hljs-built_in">any</span>]&gt;();
      useEffect(<span class="hljs-function">() =&gt;</span> {
        fetch(<span class="hljs-string">`api/service?call=getcommentsbypost&amp;id=<span class="hljs-subst">${props.postId}</span>`</span>).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.json()).then(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> setComments(x));
      }, [])

      <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;&gt;</span>
        {
          comments ?
            <span class="hljs-tag">&lt;<span class="hljs-name">List</span>
              <span class="hljs-attr">items</span>=<span class="hljs-string">{</span>
                <span class="hljs-attr">comments</span>?<span class="hljs-attr">.map</span>(<span class="hljs-attr">x</span> =&gt;</span> {
                  return {
                    key: x.id,
                    header: x.comment,
                    content: `${x.author} 发表于 ${x.time}`
                  }
                })
              }&gt;&lt;/List &gt;
            : &quot;&quot;}
        <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><span class="hljs-tag">&lt;/&gt;</span>)
    }

    useEffect(() =&gt; {
      fetch(`api/service?call=getpostsbyclass&amp;id=${props.class}`).then(x =&gt; x.json()).then(x =&gt; setPosts(x));
    }, [])
    return (<span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">items</span>=<span class="hljs-string">{</span>
      <span class="hljs-attr">posts</span>?<span class="hljs-attr">.map</span>(<span class="hljs-attr">x</span> =&gt;</span> {
        return {
          key: x.id,
          header: <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{x.content}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>,
          content: <span class="hljs-tag">&lt;<span class="hljs-name">Comment</span> <span class="hljs-attr">postId</span>=<span class="hljs-string">{x.id}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Comment</span>&gt;</span>
        }
      })
    }&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">List</span>&gt;</span>)
  }

  return (
    <span class="hljs-tag">&lt;<span class="hljs-name">Flex</span> <span class="hljs-attr">column</span> <span class="hljs-attr">fill</span> <span class="hljs-attr">gap</span>=<span class="hljs-string">&quot;gap.medium&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Segment</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;brand&quot;</span> <span class="hljs-attr">inverted</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Flex</span> <span class="hljs-attr">column</span> <span class="hljs-attr">fill</span> <span class="hljs-attr">gap</span>=<span class="hljs-string">&quot;gap.small&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">content</span>=<span class="hljs-string">{</span>`你好,家长`} <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;larger&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;这是家校通的家长界面，在这里你看到孩子的作业完成情况，以及老师下发的通知公告等&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;small&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Flex</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Segment</span>&gt;</span>

      {parentInfo &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Segment</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">items</span>=<span class="hljs-string">{</span>
          <span class="hljs-attr">parentInfo.map</span>(<span class="hljs-attr">x</span> =&gt;</span> {
            return {
              key: x.class,
              header: `作为${x.student}的${x.type}, 班级编号:${x.class}`,
              content: <span class="hljs-tag">&lt;&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>作业列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">AssignmentList</span> <span class="hljs-attr">class</span>=<span class="hljs-string">{x.class}</span> <span class="hljs-attr">student</span>=<span class="hljs-string">{x.id}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">AssignmentList</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>班级公告<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">PostList</span> <span class="hljs-attr">class</span>=<span class="hljs-string">{x.class}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">PostList</span>&gt;</span>
              <span class="hljs-tag">&lt;/&gt;</span>
            }
          })
        }&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">List</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Segment</span>&gt;</span>}


      {!parentInfo &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Segment</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Form</span>
          <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{(evt)</span> =&gt;</span> {
            const email = (evt.target as any).txtEmail.value;
            //作为范例，这里目前没有做真正的验证
            fetch(`api/service?call=getParentInfoByEmail&amp;email=${email}`).then(x =&gt; x.json()).then(x =&gt; {
              setParentInfo(x);
            }).then(_ =&gt; {
              localStorage.setItem(&quot;parentEmail&quot;, email);
            });
          }}
        &gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">FormInput</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;txtEmail&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请使用邮箱登录&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">FormInput</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">FormButton</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;登录&quot;</span> <span class="hljs-attr">primary</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">FormButton</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Form</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Segment</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Flex</span>&gt;</span>
  )
}
</span></code></pre>
<p>这个页面看起来的效果是这样的，默认情况下，家长需要先用邮件进行登录，然后会根据邮箱找到子女（可能会有多个）在不同班级中的作业列表，老师发送的公告信息，并且进行展示。</p>
<p><img src="../.gitbook/assets/图片 454.png" alt></p>
<p>到这里为止，我们能看到一个基本的原型，通过家校通这个应用，老师和学生、家长可以无缝地合作，共享信息等，他们用各自习惯用的工具，安全可控地分享信息，并且进行互动。</p>
<h2 id="完整代码">完整代码</h2>
<p>这个案例的完整代码，请通过下面地址获取</p>
<p><a href="https://github.com/code365opensource/teamsapp-samples-tab-education" target="_blank">https://github.com/code365opensource/teamsapp-samples-tab-education</a></p>
<p>这个案例主要目的是展示如何基于Teams 平台实现内部沟通，目前实现的功能很有限。但如果你的学校对这个方案感兴趣，请通过下面方式和我取得联系</p>
<p><a href="../feedback-and-follow-update.html">feedback-and-follow-update.md</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="metionall-in-group-chat.html" class="navigation navigation-prev " aria-label="Previous page: 在群聊中提醒所有人">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="sso-solution.html" class="navigation navigation-next " aria-label="Next page: 单点登录实现方案">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"description":"通过Teams让家长与老师互动，并了解孩子学习情况","title":"家校通应用","level":"3.4.5","depth":2,"next":{"title":"单点登录实现方案","level":"3.4.6","depth":2,"path":"dev-team-perspective-of-the-platform/sso-solution.md","ref":"dev-team-perspective-of-the-platform/sso-solution.md","articles":[]},"previous":{"title":"在群聊中提醒所有人","level":"3.4.4","depth":2,"path":"dev-team-perspective-of-the-platform/metionall-in-group-chat.md","ref":"dev-team-perspective-of-the-platform/metionall-in-group-chat.md","articles":[]},"dir":"ltr"},"config":{"plugins":["honkit-plugin-google-analytics","add-js"],"root":"src","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"analytics":{"uid":"G-8HPPH9FRTD"},"add-js":{"js":["../scripts/clarity.js","../scripts/googleadsense.js"]},"honkit-plugin-google-analytics":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"陈希章","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Microsoft Teams 完全手册","language":"zh-hans","gitbook":"*","description":"Microsoft Teams 完全手册，从几个不同的维度，给读者展现完整的Microsoft Teams平台，包括但不仅限于 1) Microsoft Teams 平台的起源，架构能力 2) 平台给最终用户带来的价值 3)平台给企业IT部门带来的机遇 4) 合作伙伴如何充分利用平台能力开展业务 5) 全民开发的时代，结合Power Platform实现更大价值"},"file":{"path":"dev-team-perspective-of-the-platform/bridge-for-parents-and-teachers.md","mtime":"2025-04-26T00:13:42.429Z","type":"markdown"},"gitbook":{"version":"3.6.23","time":"2025-04-26T00:13:53.222Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-add-js/5qT2ECEluEWGAemJ-clarity.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-add-js/LApdrD6079DYApfP-googleadsense.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

